24

I want to post my contact form to my Google Apps Script, which will send an e-mail to me. I use the following code:

var TO_ADDRESS = "example@gmail.com"; // where to send form data

function doPost(e) {

  var callback = e.parameter.callback;

  try {
    Logger.log(e); // the Google Script version of console.log
    MailApp.sendEmail(TO_ADDRESS, "Contact Form Submitted",
                      JSON.stringify(e.parameters));
    // return json success results
    return ContentService
          .createTextOutput(callback+
          JSON.stringify({"result":"success",
                          "data": JSON.stringify(e.parameters) }))
          .setMimeType(ContentService.MimeType.JSON);
  } catch(error) { // if error return this
    Logger.log(error);
    return ContentService
          .createTextOutput(callback+JSON.stringify({"result":"error", 
          "error": e}))
          .setMimeType(ContentService.MimeType.JSON);
  }
}
When I try to post to the Google Apps Script URL, I get the following error:

Access to XMLHttpRequest at 'https://script.google.com/macros/s/~~myscriptid~~/exec' from origin 'http://localhost:4200' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.

I have no clue how to add the CORS-filter to my google script.

I know the script is working I have tested it with a Chrome extension.

Editor's note: The extension referred to by the OP is no longer available.

google-apps-scriptweb-applicationscors
Share
Improve this question
Follow
edited Feb 22 at 19:52
Wicket's user avatar
Wicket
39.1k99 gold badges8080 silver badges199199 bronze badges
asked Nov 22, 2018 at 15:17
Joost Kaal's user avatar
Joost Kaal
49311 gold badge44 silver badges1313 bronze badges
1
sou CORS affects your angular application. where will it be run finally? there are different solutions possible depending on if it will run also at cloud, – 
skyboyer
 CommentedNov 22, 2018 at 16:07
I need it to work when my application is on a different domain then my google script – 
Joost Kaal
 CommentedNov 23, 2018 at 9:00
Add a comment
18 Answers
Sorted by:

Highest score (default)
28

After a lot of hard work, the only solution which worked for me:

In Google Apps Script

function doPost(e) {
  return ContentService.createTextOutput(JSON.stringify({status: "success", "data": "my-data"})).setMimeType(ContentService.MimeType.JSON);
}
In JavaScript

fetch(URL, {
      redirect: "follow",
      method: "POST",
      body: JSON.stringify(DATA),
      headers: {
        "Content-Type": "text/plain;charset=utf-8",
      },
    })
Note the attribute redirect: "follow" that is very important;